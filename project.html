<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FarmSnack - Mountain Purity Snacks</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter Font (Primary Body Font) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <!-- Removed Cinzel Decorative Font link -->
    <!-- Load Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            /* New Vibrant & Appetizing Mountain Theme */
            --color-primary: #0d9488; /* Deep Teal/Cyan - Main Brand */
            --color-secondary: #f97316; /* Vibrant Orange - CTA, Sale, Energy */
            --color-pink: #ec4899; /* Vibrant Pink - New Accent 1 */
            --color-light-blue: #0ea5e9; /* Bright Sky Blue - New Accent 2 / Mountain */
            --color-background: #f0fdfa; /* Lightest Aqua/Mint */
            --color-text: #1f2937; /* Dark Slate */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-background);
            color: var(--color-text);
        }
        /* Removed .font-fantasy custom class */
        .text-primary { color: var(--color-primary); }
        .bg-primary { background-color: var(--color-primary); }
        .text-secondary { color: var(--color-secondary); }
        .bg-secondary { background-color: var(--color-secondary); }
        .text-pink { color: var(--color-pink); }
        .bg-pink { background-color: var(--color-pink); }
        .text-light-blue { color: var(--color-light-blue); }
        .bg-light-blue { background-color: var(--color-light-blue); }
        
        /* Updated CTA button style for vibrant orange */
        .btn-cta {
            @apply bg-secondary text-white font-bold py-3 px-8 rounded-full transition duration-300 ease-in-out shadow-xl hover:bg-orange-600 hover:shadow-2xl;
        }

        /* Custom CSS for Circular Rotating Animation */
        @keyframes spin-subtle {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .product-image-container {
            width: 150px;
            height: 150px;
            overflow: hidden;
            border-radius: 50%;
            margin: 0 auto 1rem;
            border: 4px solid var(--color-light-blue);
            transition: all 0.5s ease-out;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .product-card:hover .product-image-container {
            border-color: var(--color-pink); /* Pink accent on hover */
            animation: spin-subtle 30s linear infinite;
            box-shadow: 0 8px 25px rgba(236, 72, 153, 0.5); /* Pink shadow */
        }
        
        .product-card:hover .product-image {
            transform: scale(1.1) rotate(-5deg);
            transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        /* Cart Sidebar Styles */
        #cart-sidebar {
            transition: transform 0.4s ease-in-out;
        }
        .cart-open {
            transform: translateX(0);
        }
        .cart-closed {
            transform: translateX(100%);
        }

        /* --- MOVING MOUNTAIN EFFECT CSS --- */
        @keyframes mountain-move {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        
        .moving-mountain-container {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 150px;
            overflow: hidden;
            z-index: 10; /* Above content */
        }

        .moving-mountain-bg {
            position: absolute;
            bottom: -50px; /* Hide bottom edge */
            left: 0;
            width: 200%; /* Wider than screen for loop */
            height: 200px;
            background: 
                /* Layer 1: Pink Peaks */
                radial-gradient(ellipse at 50% 100%, var(--color-pink) 0%, transparent 70%) 0 100px / 100px 100px repeat-x,
                /* Layer 2: Blue Peaks */
                radial-gradient(ellipse at 50% 100%, var(--color-light-blue) 0%, transparent 60%) 50px 100px / 120px 120px repeat-x;

            opacity: 0.2; /* Subtler effect */
            animation: mountain-move 40s linear infinite;
        }

        /* --- MARQUEE ANIMATION CSS (Updated for full width visibility) --- */
        @keyframes marquee-scroll {
            from { transform: translateX(0); }
            to { transform: translateX(-50%); } /* Scrolls half of the doubled content width */
        }
        
        .marquee-content {
            display: inline-block;
            padding-left: 100%; /* Start the content off-screen */
            animation: marquee-scroll 20s linear infinite; /* Increased time for slower scroll across full width */
        }
    </style>
</head>
<body class="antialiased">

    <!-- Sticky Header/Navigation -->
    <header class="sticky top-0 z-50 bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <!-- Logo: Reverted to Inter font -->
                <div class="flex-shrink-0">
                    <a href="#" class="text-3xl font-extrabold tracking-tight text-primary">FarmSnack</a>
                </div>
                <!-- Desktop Nav -->
                <nav class="hidden md:flex space-x-8">
                    <a href="#shop" class="text-gray-600 hover:text-primary transition duration-150 font-medium">Shop All</a>
                    <a href="#spreads-section" class="text-gray-600 hover:text-pink transition duration-150 font-medium">Spreads</a>
                    <a href="#bites-section" class="text-gray-600 hover:text-primary transition duration-150 font-medium">Bites</a>
                    <a href="#bars-section" class="text-gray-600 hover:text-pink transition duration-150 font-medium">Protein Bars</a>
                    <a href="#about" class="text-gray-600 hover:text-primary transition duration-150 font-medium">Our Story</a>
                </nav>
                <!-- Icons/Actions -->
                <div class="flex items-center space-x-4">
                    <button class="text-gray-600 hover:text-primary transition duration-150 p-2 rounded-full hover:bg-gray-100">
                        <i data-lucide="search" class="w-5 h-5"></i>
                    </button>
                    <!-- Cart Button opens the sidebar -->
                    <div id="cart-button" class="relative cursor-pointer text-gray-600 hover:text-primary transition duration-150 p-2 rounded-full hover:bg-gray-100" onclick="openCart()">
                        <i data-lucide="shopping-cart" class="w-5 h-5"></i>
                        <span id="cart-count" class="absolute -top-1 -right-1 inline-flex items-center justify-center px-2 py-0.5 text-xs font-bold leading-none text-white bg-secondary rounded-full">0</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- NEW FULL-WIDTH MARQUEE BANNER (Highly Visible) -->
    <div class="bg-primary py-2 overflow-hidden shadow-inner sticky top-20 z-40 md:top-auto">
        <div class="marquee-content whitespace-nowrap text-sm font-extrabold text-white uppercase tracking-widest flex items-center">
            <i data-lucide="leaf" class="w-4 h-4 text-pink mr-3 inline-block"></i> 100% PURITY WITH FRESHNESS &bull; FREE SHIPPING ON ORDERS OVER ₹999 &bull; MOUNTAIN SOURCED INGREDIENTS &bull; <i data-lucide="leaf" class="w-4 h-4 text-pink mx-3 inline-block"></i>
        </div>
    </div>
    
    <!-- Cart Sidebar -->
    <div id="cart-sidebar" class="fixed top-0 right-0 z-[100] w-full max-w-sm h-full bg-white shadow-2xl cart-closed flex flex-col">
        <div class="p-6 border-b border-gray-100 flex justify-between items-center bg-pink/10">
            <h2 class="text-2xl font-bold text-primary">Your Cart (<span id="sidebar-cart-count">0</span>)</h2>
            <button onclick="closeCart()" class="text-gray-500 hover:text-secondary p-2 rounded-full transition">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
        </div>
        
        <div id="cart-items-list" class="flex-grow p-6 overflow-y-auto space-y-4">
            <!-- Cart items will be rendered here -->
            <p class="text-center text-gray-500 mt-10" id="empty-cart-message">Your basket is mountain-empty. Add some FarmSnacks!</p>
        </div>

        <div class="p-6 border-t border-gray-100 bg-gray-50">
            <div class="flex justify-between font-bold text-xl mb-4 text-gray-900">
                <span>Subtotal:</span>
                <span id="cart-subtotal">₹ 0</span>
            </div>
            <!-- UPDATED BUTTON TO CALL handleCheckout() -->
            <button class="btn-cta w-full text-lg" onclick="handleCheckout()">
                Proceed to Checkout
            </button>
            <p class="text-xs text-center text-gray-500 mt-3">Demo mode: Payment is simulated after a short delay.</p>
        </div>
    </div>
    <!-- Overlay to close cart when clicking outside -->
    <div id="cart-overlay" class="fixed inset-0 z-[99] bg-black bg-opacity-40 hidden" onclick="closeCart()"></div>


    <!-- Main Content -->
    <main>
        <!-- 1. Hero Section (Mountain Theme with Moving Effect) -->
        <section class="relative pt-20 pb-16 md:pt-32 md:pb-24 overflow-hidden" style="background-color: var(--color-background);">
            
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 grid md:grid-cols-2 gap-12 items-center relative z-20">
                <!-- Text Content -->
                <div class="order-2 md:order-1">
                    <span class="text-pink uppercase tracking-widest font-extrabold text-sm mb-4 block">Direct Raw Material from the Mountains</span>
                    <h1 class="text-5xl lg:text-7xl font-extrabold leading-tight mb-6 text-gray-900">
                        Mountain <span class="text-primary block">Purity.</span>
                    </h1>
                    <p class="text-lg text-gray-600 mb-10 max-w-md">
                        100% served, made, and packed with purity. We bring nature's best from untouched mountain sources straight to your snack.
                    </p>
                    <a href="#shop" class="btn-cta text-lg shadow-pink/30 hover:shadow-pink/50">
                        Shop Mountain Freshness &rarr;
                    </a>
                </div>
                <!-- Image/Visual -->
                <div class="order-1 md:order-2">
                    <!-- Placeholder image URL: Light blue/Mint green background for mountain theme -->
                    <!-- Image updated to show 'Yuvraj Singh' placeholder as requested, and size adjusted to 600x600 -->
                    <img src="https://placehold.co/600x600/0d9488/f0fdfa?text=Yuvraj+Singh" 
                         alt="Image of Yuvraj Singh, a prominent sportsman, endorsing mountain purity snacks." 
                         class="w-full h-auto object-cover rounded-[3rem] shadow-2xl transition duration-700 ease-in-out hover:rotate-1 hover:scale-[1.05] border-8 border-white ring-4 ring-pink/50">
                </div>
            </div>

            <!-- Moving Mountain Background (Z-index 10) -->
            <div class="moving-mountain-container">
                <div class="moving-mountain-bg"></div>
            </div>
        </section>

        <!-- 2. Core Value Propositions -->
        <section class="py-16 md:py-24 bg-white shadow-inner relative z-20">
            <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-center text-4xl font-extrabold mb-14 text-gray-900">100% Purity Guaranteed</h2>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-8">
                    <!-- Value 1 -->
                    <div class="text-center p-6 rounded-xl transition duration-300 hover:shadow-2xl border border-gray-100 hover:border-pink/50">
                        <i data-lucide="mountain" class="w-8 h-8 text-light-blue mx-auto mb-3 transform hover:scale-110 transition duration-500"></i>
                        <h3 class="text-xl font-semibold mb-2 text-gray-900">Mountain Source</h3>
                        <p class="text-gray-600 text-sm">Ingredients harvested directly from high-altitude farms for peak nutrition.</p>
                    </div>
                    <!-- Value 2 -->
                    <div class="text-center p-6 rounded-xl transition duration-300 hover:shadow-2xl border border-gray-100 hover:border-pink/50">
                        <i data-lucide="factory-off" class="w-8 h-8 text-light-blue mx-auto mb-3 transform hover:rotate-6 transition duration-500"></i>
                        <h3 class="text-xl font-semibold mb-2 text-gray-900">Unprocessed Goodness</h3>
                        <p class="text-gray-600 text-sm">Minimally processed to preserve natural enzymes, vitamins, and minerals.</p>
                    </div>
                    <!-- Value 3 -->
                    <div class="text-center p-6 rounded-xl transition duration-300 hover:shadow-2xl border border-gray-100 hover:border-pink/50">
                        <i data-lucide="verified" class="w-8 h-8 text-light-blue mx-auto mb-3 transform hover:-rotate-6 transition duration-500"></i>
                        <h3 class="text-xl font-semibold mb-2 text-gray-900">Ethically Packed</h3>
                        <p class="text-gray-600 text-sm">Made and packed with sustainable, non-toxic methods in small batches.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. Product Display Section -->
        <section id="shop" class="py-16 md:py-24">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-4xl font-extrabold text-center mb-16 text-gray-900">Featured FarmSnacks</h2>

                <h3 id="spreads-section" class="text-3xl font-bold text-gray-800 mb-8 mt-12 border-b-2 border-primary/50 pb-2">Gourmet Spreads</h3>
                <!-- Product Grid Container -->
                <div id="product-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 md:gap-8">
                    <!-- Spreads and Bites will be injected here by JavaScript -->
                </div>

                <h3 id="bites-section" class="text-3xl font-bold text-gray-800 mb-8 mt-16 border-b-2 border-primary/50 pb-2">Healthy Bites</h3>
                <!-- Product Grid Container for Bars -->
                <div id="bar-product-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 md:gap-8">
                    <!-- Protein Bars will be injected here by JavaScript -->
                </div>

                <h3 id="bars-section" class="text-3xl font-bold text-gray-800 mb-8 mt-16 border-b-2 border-primary/50 pb-2">Power-Packed Protein Bars</h3>
                <!-- Note: Using bar-product-grid for all remaining products for simplicity, in a real app, these would be separate grids. -->

            </div>
        </section>

        <!-- 4. Testimonials Section -->
        <section id="about" class="py-16 md:py-24" style="background-color: var(--color-background);">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                <span class="text-primary uppercase tracking-widest font-bold text-sm mb-4 block text-center">Fueling Happy Lives</span>
                <h2 class="text-4xl font-extrabold text-center mb-12 text-gray-900">What Our Fans Are Saying</h2>
                
                <div class="space-y-8">
                    <!-- Testimonial 1 -->
                    <div class="bg-white p-8 rounded-2xl shadow-xl border-l-8 border-pink transform hover:scale-[1.02] transition duration-500">
                        <i data-lucide="quote" class="w-8 h-8 text-pink mb-4"></i>
                        <p class="italic text-lg text-gray-700 mb-4">"The Almond Crumble Spread is a revelation! Finally, a chocolate spread that tastes indulgent without the sugar crash. It's a staple in our pantry now."</p>
                        <div class="font-semibold text-gray-900">- Sukanya <span class="text-sm text-gray-500 block font-normal">Nutritionist, Delhi</span></div>
                    </div>
                    <!-- Testimonial 2 -->
                    <div class="bg-white p-8 rounded-2xl shadow-xl border-l-8 border-light-blue transform hover:scale-[1.02] transition duration-500">
                        <i data-lucide="quote" class="w-8 h-8 text-light-blue mb-4"></i>
                        <p class="italic text-lg text-gray-700 mb-4">"We use the Peanut Butter Blast Bar before our morning run. They are the perfect natural fuel—portable, delicious, and genuinely filling."</p>
                        <div class="font-semibold text-gray-900">- Pranjal <span class="text-sm text-gray-500 block font-normal">Mountain Climber, Uttarakhand</span></div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-300 py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-2 md:grid-cols-5 gap-8">
                <!-- Brand Info -->
                <div class="col-span-2">
                    <!-- Logo: Reverted to Inter font -->
                    <h3 class="text-3xl font-extrabold tracking-tight text-white mb-4">FarmSnack</h3>
                    <p class="text-sm">Mountain purity, snack-time delight. Follow us for farm updates.</p>
                    <div class="flex space-x-4 mt-4">
                        <a href="#" class="text-gray-400 hover:text-pink transition"><i data-lucide="instagram" class="w-5 h-5"></i></a>
                        <a href="#" class="text-gray-400 hover:text-light-blue transition"><i data-lucide="facebook" class="w-5 h-5"></i></a>
                        <a href="#" class="text-gray-400 hover:text-pink transition"><i data-lucide="mail" class="w-5 h-5"></i></a>
                    </div>
                </div>
                
                <!-- Shop Links -->
                <div>
                    <h4 class="font-semibold text-white mb-3">Shop</h4>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#spreads-section" class="hover:text-pink transition">Spreads</a></li>
                        <li><a href="#bites-section" class="hover:text-light-blue transition">Bites</a></li>
                        <li><a href="#bars-section" class="hover:text-pink transition">Protein Bars</a></li>
                        <li><a href="#shop" class="hover:text-light-blue transition">All Products</a></li>
                    </ul>
                </div>
                <!-- Support -->
                <div>
                    <h4 class="font-semibold text-white mb-3">Support</h4>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#" class="hover:text-pink transition">Track Order</a></li>
                        <li><a href="#" class="hover:text-light-blue transition">Contact Us</a></li>
                        <li><a href="#" class="hover:text-pink transition">Shipping Policy</a></li>
                    </ul>
                </div>

                <!-- Payment Gateways -->
                <div class="col-span-2 md:col-span-1">
                    <h4 class="font-semibold text-white mb-3">Secure Payments</h4>
                    <div class="flex flex-wrap gap-3">
                        <!-- UPI SVG (Generic UPI, colored green) -->
                        <div class="w-12 h-8 bg-green-500 rounded-lg shadow-lg flex items-center justify-center text-xs font-bold text-white tracking-widest">
                            UPI
                        </div>
                        <!-- GPay (Simplified Google Pay blue/yellow) -->
                        <div class="w-12 h-8 bg-blue-600 rounded-lg shadow-lg flex items-center justify-center text-xs font-bold text-white tracking-widest relative">
                            G <span class="absolute right-0 bottom-0 text-yellow-300 transform -translate-x-1 translate-y-1">P</span>
                        </div>
                        <!-- Paytm (Simplified Paytm red) -->
                        <div class="w-12 h-8 bg-red-600 rounded-lg shadow-lg flex items-center justify-center text-xs font-bold text-white tracking-widest">
                            P<span class="text-yellow-300">T</span>M
                        </div>
                        <div class="w-12 h-8 bg-gray-500 rounded-lg shadow-lg flex items-center justify-center text-xs font-bold text-white tracking-widest">
                            CARD
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-10 pt-6 border-t border-gray-800 text-center">
                <p class="text-xs text-gray-500 mb-1">
                    &copy; 2025 FarmSnack. All Rights Reserved. Conceptual Clone for demonstration.
                </p>
            </div>
        </div>
    </footer>

    <!-- Payment Status/Message Modal (Custom Alert) -->
    <div id="message-modal" class="fixed inset-0 z-[110] bg-black bg-opacity-60 flex items-center justify-center p-4 hidden">
        <div class="bg-white p-8 rounded-2xl shadow-2xl max-w-sm w-full text-center transform transition-all duration-300 scale-100">
            <div class="modal-icon mx-auto mb-4 w-fit">
                <!-- Icon will be injected by JS -->
            </div>
            <h3 id="modal-title" class="text-2xl font-extrabold mb-3 text-primary">Processing...</h3>
            <p id="modal-message" class="text-gray-600 mb-6">Simulating payment processing...</p>
            <button onclick="hideMessage()" class="bg-pink text-white font-bold py-2 px-6 rounded-full hover:bg-pink-700 transition duration-300">
                Close
            </button>
        </div>
    </div>

    <!-- JavaScript for Product Data and Interactions -->
    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // --- MOCK PRODUCT DATA ---
        const products = [
            {
                id: 1,
                name: "Almond Crumble Chocolate Spread",
                category: "spreads",
                weight: "250g Jar",
                price: 450,
                salePrice: 399,
                reviews: 57,
                imageText: "Spread-AlmondCrumble",
                isSoldOut: false
            },
            {
                id: 2,
                name: "Almond Silk Chocolate Spread",
                category: "spreads",
                weight: "250g Jar",
                price: 550,
                salePrice: 499,
                reviews: 56,
                imageText: "Spread-AlmondSilk",
                isSoldOut: false
            },
            {
                id: 3,
                name: "Walnut Brownie Chocolate Spread",
                category: "spreads",
                weight: "250g Jar",
                price: 550,
                salePrice: 499,
                reviews: 57,
                imageText: "Spread-WalnutBrownie",
                isSoldOut: true
            },
            {
                id: 4,
                name: "Almond Crumble Protein Bites",
                category: "bites",
                weight: "6 Pcs Pack",
                price: 270,
                salePrice: 239,
                reviews: 52,
                imageText: "Bite-AlmondCrumble",
                isSoldOut: true
            },
            {
                id: 5,
                name: "Chocolate Orange Date Bites",
                category: "bites",
                weight: "6 Pcs Pack",
                price: 270,
                salePrice: 239,
                reviews: 5,
                imageText: "Bite-OrangeDate",
                isSoldOut: false
            },
            {
                id: 6,
                name: "Date & Nut Power Bites",
                category: "bites",
                weight: "6 Pcs Pack",
                price: 270,
                salePrice: 249,
                reviews: 48,
                imageText: "Bite-DatePower",
                isSoldOut: false
            },
            {
                id: 7,
                name: "Dark Chocolate Mint Bar",
                category: "bars",
                weight: "50g Bar",
                price: 150,
                salePrice: 129,
                reviews: 30,
                imageText: "Bar-MintChocolate",
                isSoldOut: false
            },
            {
                id: 8,
                name: "Peanut Butter Blast Bar",
                category: "bars",
                weight: "50g Bar",
                price: 140,
                salePrice: 119,
                reviews: 65,
                imageText: "Bar-PeanutButter",
                isSoldOut: false
            },
            {
                id: 9,
                name: "Cranberry Almond Bar",
                category: "bars",
                weight: "50g Bar",
                price: 130,
                salePrice: 109,
                reviews: 42,
                imageText: "Bar-CranberryAlmond",
                isSoldOut: false
            }
        ];

        // Global state for cart and elements
        let cart = []; // Stores {id, name, price, quantity}
        const cartCountElement = document.getElementById('cart-count');
        const sidebarCartCountElement = document.getElementById('sidebar-cart-count');
        const cartSubtotalElement = document.getElementById('cart-subtotal');
        const cartItemsListElement = document.getElementById('cart-items-list');
        const productGridElement = document.getElementById('product-grid');
        const barProductGridElement = document.getElementById('bar-product-grid'); 
        const cartSidebar = document.getElementById('cart-sidebar');
        const cartOverlay = document.getElementById('cart-overlay');
        const emptyCartMessage = document.getElementById('empty-cart-message');

        
        // --- CUSTOM MESSAGE MODAL FUNCTIONS ---
        function showMessage(title, message, isSuccess) {
            const modal = document.getElementById('message-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalMessage = document.getElementById('modal-message');
            
            modalTitle.textContent = title;
            modalMessage.textContent = message;

            // Apply colors and icon based on success/failure
            modalTitle.classList.remove('text-primary', 'text-red-500');
            const iconContainer = modal.querySelector('.modal-icon');
            
            if (isSuccess) {
                modalTitle.classList.add('text-primary');
                iconContainer.innerHTML = '<i data-lucide="check-circle" class="w-10 h-10 text-primary"></i>';
            } else {
                modalTitle.classList.add('text-red-500');
                iconContainer.innerHTML = '<i data-lucide="x-octagon" class="w-10 h-10 text-red-500"></i>';
            }
            
            lucide.createIcons(); 
            modal.classList.remove('hidden');
            // Disable body scroll when modal is open
            document.body.style.overflow = 'hidden';
        }

        function hideMessage() {
            document.getElementById('message-modal').classList.add('hidden');
            // Re-enable body scroll
            document.body.style.overflow = '';
        }

        // --- CHECKOUT SIMULATION ---
        function handleCheckout() {
            if (cart.length === 0) {
                showMessage('Empty Cart', 'Please add items to your basket before checking out.', false);
                return;
            }

            // 1. Close the cart sidebar
            closeCart();
            
            // 2. Show a processing message
            showMessage('Processing...', 'Simulating secure payment via GPay/Paytm/UPI. Please wait...', true);

            // 3. Simulate API delay (5 seconds)
            setTimeout(() => {
                // In a real app, this is where you'd check the server's payment response.
                
                // Simulating a successful payment
                const finalTotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                
                // Clear cart after simulated success
                cart = [];
                updateCartCount();
                
                // Show final success message
                showMessage(
                    'Order Confirmed! 🎉', 
                    `Your payment of ₹ ${finalTotal.toLocaleString('en-IN')} was successful. Your Mountain Snacks are on their way!`, 
                    true
                );
                
                // Optional: Auto-hide the success message after 7 seconds
                setTimeout(hideMessage, 7000);

            }, 5000); // 5 second simulated processing time
        }
        
        // --- CART SIDEBAR LOGIC (Functions remain mostly the same) ---
        
        function openCart() {
            cartSidebar.classList.remove('cart-closed');
            cartSidebar.classList.add('cart-open');
            cartOverlay.classList.remove('hidden');
            // Prevent scrolling on the body when cart is open
            document.body.style.overflow = 'hidden';
            renderCart();
        }

        function closeCart() {
            cartSidebar.classList.remove('cart-open');
            cartSidebar.classList.add('cart-closed');
            cartOverlay.classList.add('hidden');
            document.body.style.overflow = '';
        }

        function updateCartCount() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            cartCountElement.textContent = totalItems;
            sidebarCartCountElement.textContent = totalItems;
            cartSubtotalElement.textContent = `₹ ${subtotal.toLocaleString('en-IN')}`; // Format with Indian locale for commas

            if (totalItems === 0) {
                emptyCartMessage.classList.remove('hidden');
            } else {
                emptyCartMessage.classList.add('hidden');
            }
        }

        function renderCart() {
            cartItemsListElement.innerHTML = ''; // Clear existing list
            
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                const cartItemHTML = `
                    <div class="flex items-center space-x-4 p-3 bg-white rounded-xl shadow-md border-l-4 border-pink">
                        <!-- Image (Mock) -->
                        <div class="w-12 h-12 bg-primary/20 rounded-lg flex-shrink-0 flex items-center justify-center text-primary font-bold text-xs">
                            ${item.name.split(' ').map(n => n[0]).join('')}
                        </div>
                        
                        <!-- Details -->
                        <div class="flex-grow">
                            <h4 class="font-semibold text-gray-800 leading-tight">${item.name}</h4>
                            <p class="text-sm text-gray-500">₹ ${item.price} x ${item.quantity}</p>
                        </div>
                        
                        <!-- Total & Controls -->
                        <div class="text-right flex items-center space-x-2">
                            <button onclick="updateQuantity(${item.id}, -1)" class="text-gray-400 hover:text-secondary p-1 rounded-full border border-gray-200">
                                <i data-lucide="minus" class="w-4 h-4"></i>
                            </button>
                            <span class="font-bold text-primary">₹ ${itemTotal}</span>
                            <button onclick="updateQuantity(${item.id}, 1)" class="text-gray-400 hover:text-secondary p-1 rounded-full border border-gray-200">
                                <i data-lucide="plus" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                `;
                cartItemsListElement.innerHTML += cartItemHTML;
            });
            
            // Re-create icons for newly added HTML
            lucide.createIcons(); 
            updateCartCount();
        }
        
        function updateQuantity(productId, delta) {
            const existingItem = cart.find(item => item.id === productId);

            if (existingItem) {
                existingItem.quantity += delta;
                if (existingItem.quantity <= 0) {
                    // Remove item if quantity is zero or less
                    cart = cart.filter(item => item.id !== productId);
                }
            }
            renderCart();
        }
        
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            
            if (!product) {
                console.error("Product not found with ID:", productId);
                return;
            }

            if (product.isSoldOut) {
                // If sold out, we just skip adding it and open the cart to show other items.
                console.warn(`Product ${product.name} is sold out.`);
                openCart(); 
                return;
            }

            const existingItem = cart.find(item => item.id === productId);

            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.salePrice > 0 ? product.salePrice : product.price,
                    quantity: 1,
                    imageText: product.imageText
                });
            }
            
            updateCartCount();
            openCart(); // Open the cart immediately after adding an item
        }
        
        // --- RENDERING PRODUCT CARDS (Function remains the same) ---
        function renderProducts() {
            productGridElement.innerHTML = ''; 
            barProductGridElement.innerHTML = '';
            
            // Filter products into their respective categories
            const spreadsAndBites = products.filter(p => p.category === 'spreads' || p.category === 'bites');
            const bars = products.filter(p => p.category === 'bars');

            const createProductCard = (product) => {
                const currentPrice = product.salePrice > 0 ? product.salePrice : product.price;
                const isSale = product.price > product.salePrice;
                
                const priceHTML = isSale 
                    ? `<span class="text-2xl font-extrabold text-secondary">₹ ${currentPrice}</span>
                       <span class="text-sm text-gray-400 line-through ml-2">₹ ${product.price}</span>`
                    : `<span class="text-2xl font-extrabold text-primary">₹ ${currentPrice}</span>`;

                const buttonHTML = product.isSoldOut 
                    ? `<button class="w-full py-3 bg-gray-400 text-white font-semibold rounded-full cursor-not-allowed" disabled>Sold Out</button>`
                    : `<button onclick="addToCart(${product.id})" class="w-full py-3 bg-primary text-white font-bold rounded-full transition duration-300 hover:bg-teal-700 shadow-lg shadow-primary/30 flex items-center justify-center space-x-2">
                            <i data-lucide="shopping-cart" class="w-5 h-5"></i>
                            <span>Add to Basket</span>
                       </button>`;

                const saleBadge = isSale 
                    ? `<span class="absolute top-4 right-4 bg-pink text-white text-xs font-bold px-3 py-1 rounded-full uppercase z-20 shadow-xl shadow-pink/50">SALE</span>`
                    : '';
                
                // Determine placeholder image URL based on category
                let placeholderColor = (product.category === 'bars') ? 'f97316' : '0d9488'; // Orange for bars, Teal for spreads
                let imagePlaceholderUrl = `https://placehold.co/400x400/${placeholderColor}/f0fdfa?text=${product.imageText.replace(/ /g, '+')}`;


                return `
                    <div class="product-card bg-white p-6 rounded-3xl shadow-xl transition duration-500 transform hover:-translate-y-3 relative group border border-gray-100 overflow-hidden">
                        ${saleBadge}
                        
                        <!-- Image Container with Circular Border & Rotation -->
                        <div class="product-image-container mb-6">
                            <img src="${imagePlaceholderUrl}" 
                                 alt="${product.name}" 
                                 class="product-image w-full h-full object-cover transition-transform duration-700"
                                 onerror="this.onerror=null;this.src='https://placehold.co/400x400/f0fdfa/1f2937?text=Product';"
                            >
                        </div>

                        <!-- Product Details -->
                        <div class="text-center pt-2">
                            <h3 class="text-xl font-bold text-gray-900 mb-1 leading-snug">${product.name}</h3>
                            <p class="text-sm text-gray-500 mb-3">${product.weight} | ${product.reviews} Reviews</p>
                            
                            <!-- Price -->
                            <div class="flex justify-center items-baseline mb-4 h-8">
                                ${priceHTML}
                            </div>
                            
                            ${buttonHTML}
                        </div>
                    </div>
                `;
            };

            // Render Spreads and Bites
            spreadsAndBites.forEach(product => {
                productGridElement.innerHTML += createProductCard(product);
            });

            // Render Bars
            bars.forEach(product => {
                barProductGridElement.innerHTML += createProductCard(product);
            });
            
            // Re-create icons for newly added HTML
            lucide.createIcons();
        }

        // Initialize on window load
        window.onload = function() {
            renderProducts();
            updateCartCount(); // Initialize cart count to 0
        };
    </script>
</body>
</html>
